# UML超入門

UMLの超入門編です(オライリーのUML入門をべースにしてます)

## UMLとは
ソフトウェアを開発する際には、まずシステム要件などを自然言語（日本語など）で記述し、プログラミング言語を使ってソフトウェアを実装します。
この要件と実装のギャップを埋めるためのツールが、`UML(Unified Modeling Language)`です。UMLは、`ISO/IEC 19501-2:2012`として規格化(UML2.4.1)されています。
UMLは、`OMG(Object Modeling Group)`が管理・提供しています。
OMGは、以下の目標を達成できるようにUMLを定義しています。

- すぐに利用できること。
- 表現力に富んでいること。
- 簡潔であること。
- 厳密であること。
- 拡張可能であること。
- 実装に依存しないこと。
- 開発プロセスに依存しないこと


## UMLのダイアグラム
UML2.0 では13種類のダイアグラムが、規定されています。
UMLのダイアグラムは、対象の静的な側面を記述する`構造図`と、対象の動的な側面を記述する`振る舞い図`に大別できます。

### 構造図
構造図は、モデリングする対象の構造に着目したダイアグラムです。構造図には以下の6つのダイアグラムが含まれます。

- クラス図...クラスの仕様・関係（関連・継承）を定義する
- オブジェクト図...インスタンスとその関係を定義する
- パッケージ図...モデルの要素を分類する
- コンポジット構造図...クラスの内部構造を定義する
- コンポーネント図...コンポーネントを定義する
- 配置図... システムの物理的な構成を定義する

### 振る舞い図
振る舞い図は、モデリング対象の振る舞いに着目したダイアグラムです。振る舞い図には、以下の7つのダイアグラムが含まれます。

- ユースケース図...システムが提供する機能を定義する
- アクティビティ図...プログラムの実行順序を定義する
- 状態マシン図...状態と状態遷移を定義する
- シーケンス図...クラス間の相互作用を時系列的に定義する
- コミュニケーション図...クラス間の相互作用を暮らす感の関係に着目して定義する
- 相互作用概念図...相互作用の実行順序を定義する
- タイミング図...相互作用と状態遷移に関する時間制約を定義する

このように、UMLでは対象の着目したい仕組みに応じてモデリングできるようにたくさんのダイアグラムが提供されていますが、使用する頻度が高いのは以下のダイアグラムだと思います。
逆に言えばそれ以外は、開発者目線ではあまり使わないと思います（システムインテグレーターや組み込みなどでは、提供するシステムに応じて配置図や状態マシン図も使うと思います）

実際に私が社内で図解するときに利用しているのは次ぐらいです。

1. クラス図...プログラミングするときのクラス設計するとき
1. パッケージ図...上に同じ
1. 配置図...オンプレのサーバー構成を作図するとき
1. ユースケース図...新規開発の際に要件をとりまとめるとき
1. シーケンス図...新規開発で外部サービスなどと連携する際に、処理順序を規定するとき


## クラス図
### クラス図の要素
- クラス
- インタフェース
- 継承
- 実現
- 依存
- 集約・コンポジション
- 関連
- 継承
- インタフェースと実現（実装）
- ステレオタイプ

#### クラス図の構造
- クラス
  - ３段に分かれた矩形で表現されます。上段にクラス名、中段にフィールド、下段にメソッドがそれぞれ記載されます。
- 可視性は`+`がpublic, `#`がprotected, `-`がプライベート, `~`がパッケージになります。
- 継承は、継承先から継承元への矢印で定義されます。

```plantuml
'class キーワードでクラスを定義
class Base {
    id: number
    + func1()
    # func2()
    - func3()
    ~ func4()
    {static} staticValue: number
}

class Inherit {

}

Base <|-- Inherit
```

- インタフェース 
  - フィールドのないクラス図として表現されます。
  -  インタフェースを実装するクラスは、インタフェースに対して破線矢印を定義します。
```plantuml
'インタフェースキーワードで interfaceを定義
interface IValue {
    + getValue()
}

class Value {

}

IValue <|.. Value : 実現
```

- 依存
  - クラス間の依存関係を表現するときに使います。
  - 依存する方からされる向きに対しての破線矢印で表現されます。
  
```plantuml
class Controller {

}

interface ILogger {

}

Controller ..> ILogger : DI
```

- 集約・コンポジション
  - フィールドにクラスを用いるようなケースで使います。
  - 集約とコンポジションは、クラスで保持しているという観点では同じですが、生存期間が異なります。
  - オブジェクトの生存期間とクラスの生存期間が異なる場合を集約、同じ場合をコンポジションと呼びます。

```plantuml
class A {

}

class B {

}

'o-で集約
A o- B

'*-でコンポジション
A *- B
```


## シーケンス図
### シーケンス図の要素
- アクター(オブジェクト)
- ライフライン
- 活性区間
- 同期メッセージ
- 非同期メッセージ
- 消滅
- リターンメッセージ
- alt / loop
- ref
### シーケンス図の構造
```plantuml
'actorキーワードで、アクターを定義。アクターは利用者
actor アクター as user

'boundaryキーワードで、バウンダリを定義。バウンダリはUI
boundary  バウンダリ as boundary

'controlキーワードで、コントローラを定義。コントロールはコントローラー
control コントロール as controller

'entityキーワードで、エンティティを定義エンティティは実データ
entity エンティティ as database

'activateキーワードで生存線を活性化
activate user
user->boundary: コメントで関連の説明をかける

'refを使って別の図を参照
ref  over user, database
XXX図を参照
end ref

activate boundary
'altを使って条件分岐
alt 分岐条件
    boundary->>controller
        activate controller
            controller->database
            activate database
                database->database
                database-->controller
            deactivate database
            controller-->>boundary
        deactivate controller
    boundary-->user
else
    boundary-->user: 
end 
deactivate boundary



activate user
user->boundary
activate boundary
'loopで繰り返し使って条件分岐
loop 繰り返し条件 
    boundary->boundary: カウントアップなど
end 
boundary-->user
deactivate boundary
deactivate user

destroy user
destroy boundary
destroy controller
destroy database
hide footbox
```

### 例題
- オージス総研のオブジェクト倶楽部で扱いやすい例が載っていたいのでこれを改変して使います。 
  - どこかで見たようなシステムですね

```
A社では、社員の出退勤管理にWeb上の出退勤管理システムを用いている。この出退勤システムでは、A社に登録されている社員IDを利用してログインでき、ログイン後は社員は出勤・退勤を理画面上から選んでそれぞれの時間を打刻できる。打刻したデータは、データベース上に保管される。
```

1. 勤怠入力のクラスを洗い出せ。
1. 1.で洗い出したクラス群を関連付けよ
1. ログインから出勤までの処理順をシーケンス図で表現せよ。
