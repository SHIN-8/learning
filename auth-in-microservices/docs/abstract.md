# 認証/認可についての調査結果

## 1. これから取り扱うことになる認証/認可の仕組みについて

認証と認可の雑な説明。

- 認証「あなたは誰々ですね」
- 認可「これ(リソース)を扱うことを許可します」

## 2. 認証/認可の仕組みをどのように導入するのが適切か

認証/認可サーバの可用性の問題や、現在のシステムが AWS で構築されていることを考慮すると、認証/認可も AWS 上で行うのが適切と考える。

### 認証

当社システムのマイクロサービス化にあたり、すべての API の入口として Amazon API Gateway を設置し、API Gateway と連携可能な認証サービスで認証を行う。

### 認可

認可については API Gateway では必要最低限（認証されているかどうか程度）とし、各エンドポイントに対する認可はマイクロサービス内、もしくはそのサイドカープロキシで行うことととする（詳細は [こちら](./authorization.md)）。

## 3. 2で定めた仕組み上のデメリットや技術的対応の必要が考えられることの整理

Amazon API Gateway で使用できるコンポーネントは REST API と HTTP API の 2 つ（WebSocket を除く）。それぞれに利用できる認証/認可基盤は以下の通り。

- REST API
  - Lambda オーソライザー
  - Cognito オーソライザー
- HTTP API
  - JWT オーソライザー（Cognito を JWT 検証基盤として利用可能）

いずれの場合も，以下のどちらかを構築する必要がある。

- Amazon Cognito ユーザープール
  - マネージドなユーザー認証基盤
- Spring Security on ECS
  - Kotlin + Spring Security の認証 API サーバーをコンテナ基盤で動かす

## 4. 1~3 を踏まえて社内要件に合致する仕組みを導入する方法等について

作成中。
